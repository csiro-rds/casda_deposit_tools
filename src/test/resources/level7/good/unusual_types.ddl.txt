-- Table creation script for Catalogue containing unusual data types
-- Generated by CASDA Data Deposit on 2015-04-07

UPDATE casda.catalogue SET entries_table_name = 'casda.level7_unusual', version = (version+1)
WHERE level7_collection_id = (SELECT id FROM casda.level7_collection WHERE dap_collection_id = 123456)
  AND filename = 'unusual_types_catalogue.xml';

CREATE table casda.level7_unusual (
    id BIGSERIAL PRIMARY KEY,
    catalogue_id BIGINT NOT NULL,
    source_ident VARCHAR(4),
    source_name VARCHAR(26),
    boolean_field BOOLEAN,
    bit_field BIT VARYING(8),
    unsigned_byte_field SMALLINT,
    ra_deg_cont DOUBLE PRECISION,
    dec_deg_cont DOUBLE PRECISION,
    Name_with_Caps VARCHAR(22)
);

CREATE INDEX ON casda.level7_unusual(catalogue_id); 
CREATE INDEX ON casda.level7_unusual(source_name); 
CREATE INDEX ON casda.level7_unusual(ra_deg_cont); 
CREATE INDEX ON casda.level7_unusual(dec_deg_cont); 

COMMENT ON TABLE casda.level7_unusual is 'Catalogue containing unusual data types';
COMMENT ON COLUMN casda.level7_unusual.id is 'Primary key'; 
COMMENT ON COLUMN casda.level7_unusual.catalogue_id is 'Foreign key to the catalogue table'; 
COMMENT ON COLUMN casda.level7_unusual.source_ident is 'Component number'; 
COMMENT ON COLUMN casda.level7_unusual.source_name is 'Designation for the radio component'; 
COMMENT ON COLUMN casda.level7_unusual.boolean_field is 'A boolean data field'; 
COMMENT ON COLUMN casda.level7_unusual.bit_field is 'A field for bit values'; 
COMMENT ON COLUMN casda.level7_unusual.unsigned_byte_field is 'An unsigned byte field'; 
COMMENT ON COLUMN casda.level7_unusual.ra_deg_cont is 'J2000 right ascension in decimal degrees'; 
COMMENT ON COLUMN casda.level7_unusual.dec_deg_cont is 'J2000 declination in decimal degrees'; 
COMMENT ON COLUMN casda.level7_unusual.Name_with_Caps is 'Test field with capitals in the name'; 

-- TAP metadata creation script for Catalogue containing unusual data types
-- Generated by CASDA Data Deposit on 2015-04-07

INSERT INTO casda.tap_schemas (schema_name, description)
    SELECT 'AS031', 'Derived catalogues for project AS031'
    WHERE NOT EXISTS (
    (SELECT * from casda.tap_schemas WHERE schema_name = 'AS031'));

INSERT INTO casda.tap_tables (schema_name, table_name, table_type, db_schema_name, db_table_name, description, scs_enabled, params )
VALUES ('AS031', 'AS031.level7_unusual', 'table', 'casda', 'level7_unusual', 'Catalogue containing unusual data types', true, 'Catalogue Name : Level7_unusual | Principal Fields : source_name,ra_deg_cont, dec_deg_cont | Indexed Fields : source_name,ra_deg_cont,dec_deg_cont | Project Code : AS031');

INSERT INTO casda.tap_columns (column_order, db_column_name, table_name, datatype, size, principal, indexed, std, description, column_name,  ucd, unit, scs_verbosity )
VALUES 
(1, 'id', 'AS031.level7_unusual', 'BIGINT', 19, 1, 1, 1, 'Primary key', 'id', 'meta.record', null, 1),
(2, 'catalogue_id', 'AS031.level7_unusual', 'BIGINT', 19, 1, 1, 1, 'Catalogue identifier', 'catalogue_id', null, null, 3),
(3, 'source_ident', 'AS031.level7_unusual', 'VARCHAR', 4, 0, 0, 1, 'Component number', 'source_ident', 'meta.id;meta.main', null, 3),
(4, 'source_name', 'AS031.level7_unusual', 'VARCHAR', 26, 1, 1, 1, 'Designation for the radio component', 'source_name', 'meta.id', null, 1),
(5, 'boolean_field', 'AS031.level7_unusual', 'BOOLEAN', 4, 0, 0, 1, 'A boolean data field', 'boolean_field', null, null, 3),
(6, 'bit_field', 'AS031.level7_unusual', 'VARBINARY', 8, 0, 0, 1, 'A field for bit values', 'bit_field', null, null, 3),
(7, 'unsigned_byte_field', 'AS031.level7_unusual', 'SMALLINT', 4, 0, 0, 1, 'An unsigned byte field', 'unsigned_byte_field', null, null, 3),
(8, 'ra_deg_cont', 'AS031.level7_unusual', 'DOUBLE', 19, 1, 1, 1, 'J2000 right ascension in decimal degrees', 'ra_deg_cont', 'pos.eq.ra;meta.main', 'deg', 1),
(9, 'dec_deg_cont', 'AS031.level7_unusual', 'DOUBLE', 19, 1, 1, 1, 'J2000 declination in decimal degrees', 'dec_deg_cont', 'pos.eq.dec;meta.main', 'deg', 1),
(10, 'name_with_caps', 'AS031.level7_unusual', 'VARCHAR', 22, 0, 0, 1, 'Test field with capitals in the name', 'name_with_caps', null, null, 3)
;

INSERT INTO casda.tap_keys (key_id, from_table, target_table, description )
VALUES ((SELECT max(cast(numericalkeys.nums[1] as int)) + 1 from (SELECT regexp_matches(key_id, '^\d+$') as nums from casda.tap_keys) as numericalkeys), 'AS031.level7_unusual', 'casda.catalogue', 'Foreign key from level7_unusual to catalogue table');

INSERT INTO casda.tap_key_columns (id, key_id, from_column, target_column, from_table, target_table )
VALUES ((SELECT max(id) + 1 from casda.tap_key_columns), (SELECT key_id FROM casda.tap_keys where from_table = 'AS031.level7_unusual' and target_table = 'casda.catalogue'), 'catalogue_id', 'id', 'AS031.level7_unusual', 'casda.catalogue');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S001', 'ATCDFS_J032602.78-284709.0', 'f', B'101010', 4, 51.5116039999999984, -28.7858499999999999, 'A1');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S002', 'ATCDFS_J032604.15-275659.3', 't', B'1', 0, 51.5172999999999988, -27.9498309999999996, 'A2');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S003', 'ATCDFS_J032605.68-274734.4', 't', B'0', 255, 51.5236879999999999, -27.7929110000000001, 'A3');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S004', 'ATCDFS_J032606.95-275332.2', 'f', B'001', 254, 51.5289789999999996, -27.8922939999999997, 'A4');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S005', 'ATCDFS_J032611.47-273243.8', 't', B'111', 255, 51.5478129999999979, -27.5455030000000001, 'A5');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S006', 'ATCDFS_J032613.70-281717.7', 'f', B'000', 32, 51.5570870000000028, -28.288253000000001, 'A6');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S007', 'ATCDFS_J032615.48-284629.2', 't', B'1', 1, 51.5645379999999989, -28.7747889999999984, 'A7');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S008', 'ATCDFS_J032615.55-280601.0', 'f', B'0', 0, 51.564821000000002, -28.1002919999999996, 'A8');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S009', 'ATCDFS_J032616.35-280014.6', NULL, B'1', 1, 51.5681379999999976, -28.0040580000000006, 'A9');

INSERT INTO casda.level7_unusual (catalogue_id, source_ident, source_name, boolean_field, bit_field, unsigned_byte_field, ra_deg_cont, dec_deg_cont, Name_with_Caps)
VALUES ((SELECT id from casda.catalogue where catalogue_type = 'LEVEL7' and entries_table_name = 'casda.level7_unusual'), 'S010', 'ATCDFS_J032616.41-271621.1', NULL, B'0', 10, 51.5684129999999996, -28.0040580000000006, 'A10');
